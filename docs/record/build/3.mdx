---
title: "Vite é…ç½®"
author: "ä¸‹è½é¦™æ¨Ÿæ ‘"
---

# Vite é…ç½®

**[Vite](https://cn.vite.dev/guide/)** æ˜¯ä¸€ä¸ªè¶…å¿«é€Ÿçš„å‰ç«¯æ„å»ºå·¥å…·ï¼Œæ¨åŠ¨ç€ä¸‹ä¸€ä»£ç½‘ç»œåº”ç”¨çš„å‘å±•ã€‚

-   [Vite å®˜æ–¹æ–‡æ¡£](https://cn.vite.dev/)ã€ŒğŸ‘ˆ ç‚¹å‡»æŸ¥é˜…ã€

`vite.config.js` æ˜¯ Vite é¡¹ç›®çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨ Vite æä¾›çš„ API è¿›è¡Œé¡¹ç›®çš„æ„å»ºé…ç½®ã€‚ä»¥ä¸‹æ˜¯ `vite.config.js` ä¸­å¸¸ç”¨é…ç½®é¡¹çš„è¯¦ç»†è¯´æ˜å’Œç¤ºä¾‹ï¼Œå¸®åŠ©ä½ æ ¹æ®éœ€æ±‚çµæ´»é…ç½® Vite é¡¹ç›®ã€‚

---

### 1. åŸºç¡€é…ç½®

**`vite.config.js` åŸºæœ¬æ¨¡æ¿ï¼š**

```javascript
import { defineConfig } from "vite";

export default defineConfig({
	root: ".", // é¡¹ç›®æ ¹ç›®å½•ï¼Œé»˜è®¤ä¸ºå½“å‰ç›®å½•
	base: "/", // å…¬å…±è·¯å¾„ï¼Œé»˜è®¤ä¸º '/'
	mode: "development", // æ¨¡å¼ï¼Œå¯é€‰å€¼ 'development' æˆ– 'production'
	server: {
		port: 3000, // å¼€å‘æœåŠ¡å™¨ç«¯å£
		open: true, // è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
		proxy: {} // é…ç½®ä»£ç†
	},
	build: {
		outDir: "dist", // æ‰“åŒ…è¾“å‡ºç›®å½•
		sourcemap: false // æ˜¯å¦ç”Ÿæˆ Source Map
	}
});
```

---

### 2. è¯¦ç»†é…ç½®è¯´æ˜

#### 2.1 `root`

æŒ‡å®šé¡¹ç›®çš„æ ¹ç›®å½•ã€‚é»˜è®¤å€¼æ˜¯å½“å‰å·¥ä½œç›®å½•ã€‚

```javascript
root: './src',  // å°†é¡¹ç›®æ ¹ç›®å½•è®¾ç½®ä¸º src
```

#### 2.2 `base`

è®¾ç½®åº”ç”¨çš„å…¬å…±è·¯å¾„ï¼Œé€šå¸¸ç”¨äºéƒ¨ç½²æ—¶çš„è·¯å¾„å‰ç¼€ã€‚

```javascript
base: '/my-app/',  // éƒ¨ç½²åº”ç”¨æ—¶ï¼Œé™æ€èµ„æºè·¯å¾„ä¼šä»¥ '/my-app/' å¼€å¤´
```

#### 2.3 `mode`

æŒ‡å®šè¿è¡Œæ¨¡å¼ï¼Œå¯ä»¥æ˜¯ `development` æˆ– `production`ã€‚å¯ä»¥è‡ªå®šä¹‰å…¶ä»–æ¨¡å¼ï¼Œå¹¶é€šè¿‡ `.env` æ–‡ä»¶åŠ è½½ç¯å¢ƒå˜é‡ã€‚

```javascript
mode: process.env.NODE_ENV || 'development',
```

---

### 3. å¼€å‘æœåŠ¡å™¨é…ç½®ï¼š`server`

`server` é…ç½®ç”¨äºè®¾ç½®å¼€å‘æœåŠ¡å™¨çš„è¡Œä¸ºï¼š

```javascript
server: {
  port: 4000,               // å¯åŠ¨æœåŠ¡å™¨çš„ç«¯å£å·
  open: true,               // æ˜¯å¦åœ¨å¯åŠ¨æ—¶è‡ªåŠ¨æ‰“å¼€æµè§ˆå™¨
  https: false,             // æ˜¯å¦å¯ç”¨ HTTPS
  cors: true,               // å¯ç”¨è·¨åŸŸ
  proxy: {                  // é…ç½®è·¨åŸŸä»£ç†
    '/api': {
      target: 'https://api.example.com',
      changeOrigin: true,
      rewrite: (path) => path.replace(/^\/api/, ''),
    },
  },
},
```

-   **`proxy`**: ç”¨äºé…ç½® API ä»£ç†ã€‚ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ`/api` çš„è¯·æ±‚ä¼šè¢«ä»£ç†åˆ° `https://api.example.com`ã€‚

---

### 4. æ„å»ºé…ç½®ï¼š`build`

`build` é…ç½®ç”¨äºæ§åˆ¶ç”Ÿäº§ç¯å¢ƒçš„æ„å»ºè¡Œä¸ºï¼š

```javascript
build: {
  outDir: 'dist',           // æ‰“åŒ…è¾“å‡ºç›®å½•
  assetsDir: 'assets',      // é™æ€èµ„æºçš„å­˜æ”¾ç›®å½•
  sourcemap: true,          // æ˜¯å¦ç”Ÿæˆ Source Map æ–‡ä»¶
  minify: 'esbuild',        // å‹ç¼©æ–¹å¼ï¼Œå¯é€‰ 'esbuild', 'terser' æˆ– `false`
  rollupOptions: {          // è‡ªå®šä¹‰ Rollup æ‰“åŒ…é…ç½®
    input: {
      main: './index.html',
      nested: './nested/index.html',
    },
    output: {
      manualChunks: {
        vendor: ['react', 'react-dom'], // æ‰‹åŠ¨æ‹†åˆ†ä»£ç 
      },
    },
  },
  chunkSizeWarningLimit: 500, // å•ä¸ª chunk æ–‡ä»¶å¤§å°è­¦å‘Šçš„é™åˆ¶ï¼ˆå•ä½ KBï¼‰
},
```

---

### 5. æ¨¡å—è§£æé…ç½®ï¼š`resolve`

`resolve` é…ç½®ç”¨äºæ§åˆ¶æ¨¡å—è·¯å¾„çš„è§£æè¡Œä¸ºï¼š

```javascript
resolve: {
  alias: {                  // è·¯å¾„åˆ«å
    '@': '/src',            // ä½¿ç”¨ '@' ä»£æ›¿ '/src'
    components: '/src/components',
  },
  extensions: ['.js', '.jsx', '.ts', '.tsx', '.json'], // è‡ªåŠ¨æ‰©å±•æ–‡ä»¶å
},
```

-   **`alias`**: é…ç½®è·¯å¾„åˆ«åï¼Œæ–¹ä¾¿å¼•ç”¨æ¨¡å—æ—¶ä½¿ç”¨ç®€çŸ­çš„è·¯å¾„ã€‚
-   **`extensions`**: é…ç½®è‡ªåŠ¨è§£æçš„æ–‡ä»¶æ‰©å±•åã€‚

---

### 6. æ’ä»¶é…ç½®ï¼š`plugins`

Vite æ”¯æŒé€šè¿‡æ’ä»¶æ‰©å±•åŠŸèƒ½ã€‚å¸¸ç”¨æ’ä»¶åŒ…æ‹¬ React æ’ä»¶ã€Vue æ’ä»¶ç­‰ã€‚

#### æ·»åŠ  React æ’ä»¶

```javascript
import react from "@vitejs/plugin-react";

export default defineConfig({
	plugins: [react()]
});
```

#### æ·»åŠ  Vue æ’ä»¶

```javascript
import vue from "@vitejs/plugin-vue";

export default defineConfig({
	plugins: [vue()]
});
```

#### æ·»åŠ å…¶ä»–æ’ä»¶

Vite æä¾›äº†ä¸°å¯Œçš„æ’ä»¶ç”Ÿæ€ï¼Œæ¯”å¦‚ PWA æ’ä»¶ã€å›¾åƒä¼˜åŒ–æ’ä»¶ç­‰ã€‚

---

### 7. ç¯å¢ƒå˜é‡é…ç½®

Vite æ”¯æŒ `.env` æ–‡ä»¶ç®¡ç†ç¯å¢ƒå˜é‡ã€‚é»˜è®¤ä¼šåŠ è½½ä»¥ä¸‹æ–‡ä»¶ï¼ˆæ ¹æ®æ¨¡å¼åŠ è½½ï¼‰ï¼š

-   `.env`ï¼šæ‰€æœ‰æ¨¡å¼é€šç”¨
-   `.env.development`ï¼šä»…åœ¨ `development` æ¨¡å¼åŠ è½½
-   `.env.production`ï¼šä»…åœ¨ `production` æ¨¡å¼åŠ è½½

#### ç¤ºä¾‹ï¼š

åˆ›å»º `.env` æ–‡ä»¶ï¼š

```env
VITE_API_BASE_URL=https://api.example.com
```

åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼š

```javascript
console.log(import.meta.env.VITE_API_BASE_URL);
```

> æ³¨æ„ï¼šç¯å¢ƒå˜é‡éœ€è¦ä»¥ `VITE_` å¼€å¤´æ‰èƒ½åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­è®¿é—®ã€‚

---

### 8. åŠ¨æ€å¯¼å…¥å’Œä»£ç åˆ†å‰²

Vite é»˜è®¤æ”¯æŒåŠ¨æ€å¯¼å…¥å’Œä»£ç åˆ†å‰²ã€‚

#### åŠ¨æ€å¯¼å…¥

```javascript
import("./module").then(module => {
	module.default();
});
```

#### æ‰‹åŠ¨åˆ†åŒ…

```javascript
build: {
  rollupOptions: {
    output: {
      manualChunks: {
        lodash: ['lodash'], // å°† lodash å•ç‹¬æ‰“åŒ…ä¸ºä¸€ä¸ª chunk
      },
    },
  },
},
```

---

### 9. CSS å¤„ç†é…ç½®ï¼š`css`

`css` é…ç½®ç”¨äºæ§åˆ¶ CSS çš„å¤„ç†è¡Œä¸ºï¼š

```javascript
css: {
  preprocessorOptions: { // é…ç½® CSS é¢„å¤„ç†å™¨
    scss: {
      additionalData: `@import "@/styles/variables.scss";`, // å…¨å±€å¼•å…¥ SCSS å˜é‡
    },
  },
  modules: {             // é…ç½® CSS æ¨¡å—åŒ–
    localsConvention: 'camelCase', // ä½¿ç”¨é©¼å³°å‘½åè§„åˆ™
    scopeBehaviour: 'local',       // é»˜è®¤æ˜¯ localï¼Œæ¨¡å—åŒ–è¡Œä¸º
  },
  postcss: {
    plugins: [require('autoprefixer')], // æ·»åŠ  PostCSS æ’ä»¶
  },
},
```

---

### 10. å…¶ä»–é«˜çº§é…ç½®

#### ä½¿ç”¨ `define` æ³¨å…¥å…¨å±€å˜é‡

```javascript
define: {
  __APP_VERSION__: JSON.stringify('1.0.0'),
},
```

åœ¨ä»£ç ä¸­ä½¿ç”¨ï¼š

```javascript
console.log(__APP_VERSION__); // è¾“å‡º '1.0.0'
```

#### ç¦ç”¨ HMRï¼ˆçƒ­æ¨¡å—æ›¿æ¢ï¼‰

```javascript
server: {
  hmr: false, // ç¦ç”¨ HMR
},
```

---

### 11. å®Œæ•´ç¤ºä¾‹é…ç½®

ä»¥ä¸‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ `vite.config.js` ç¤ºä¾‹ï¼š

```javascript
import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

export default defineConfig({
	base: "/my-app/",
	plugins: [react()],
	server: {
		port: 4000,
		open: true,
		proxy: {
			"/api": {
				target: "https://api.example.com",
				changeOrigin: true,
				rewrite: path => path.replace(/^\/api/, "")
			}
		}
	},
	build: {
		outDir: "dist",
		sourcemap: false,
		rollupOptions: {
			output: {
				manualChunks: {
					vendor: ["react", "react-dom"]
				}
			}
		}
	},
	resolve: {
		alias: {
			"@": "/src"
		}
	},
	css: {
		preprocessorOptions: {
			scss: {
				additionalData: `@import "@/styles/variables.scss";`
			}
		}
	}
});
```

è¿™ä»½é…ç½®æ¶µç›–äº†å¼€å‘ç¯å¢ƒã€ç”Ÿäº§ç¯å¢ƒã€ä»£ç†ã€CSS é¢„å¤„ç†ã€åŠ¨æ€å¯¼å…¥ç­‰å¸¸è§åœºæ™¯ï¼Œé€‚ç”¨äºå¤§éƒ¨åˆ†å‰ç«¯é¡¹ç›®ã€‚
