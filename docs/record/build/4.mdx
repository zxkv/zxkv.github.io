---
title: "Vue CLI é…ç½®"
author: "ä¸‹è½é¦™æ¨Ÿæ ‘"
---

# Vue CLI é…ç½®

### ä¾èµ–å®‰è£…

- å®‰è£…æ’ä»¶

```bash title="å®‰è£…å…¨å±€æ’ä»¶"
npm install -g @vue/cli
# or
yarn global add @vue/cli
```

- åˆ›å»ºé¡¹ç›®

```bash title="åˆ›å»ºé¡¹ç›®"
vue create my-project
# or
vue ui
```

- å‘½ä»¤é…ç½®

```bash title=" package.json å¯åŠ¨å‘½ä»¤é…ç½®"
{
    "scripts": {
        "serve": "vue-cli-service serve",
        "build": "vue-cli-service build"
    }
}
```

- é…ç½®æ–‡ä»¶`vue.config.js`

```bash title="serve å¯åŠ¨é…ç½®"
ç”¨æ³•ï¼švue-cli-service serve [options] [entry]

é€‰é¡¹ï¼š
    --open    åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶æ‰“å¼€æµè§ˆå™¨
    --copy    åœ¨æœåŠ¡å™¨å¯åŠ¨æ—¶å°† URL å¤åˆ¶åˆ°å‰ªåˆ‡ç‰ˆ
    --mode    æŒ‡å®šç¯å¢ƒæ¨¡å¼ (é»˜è®¤å€¼ï¼šdevelopment)
    --host    æŒ‡å®š host (é»˜è®¤å€¼ï¼š0.0.0.0)
    --port    æŒ‡å®š port (é»˜è®¤å€¼ï¼š8080)
    --https   ä½¿ç”¨ https (é»˜è®¤å€¼ï¼šfalse)
```

```bash title="build æ‰“åŒ…é…ç½®"
ç”¨æ³•ï¼švue-cli-service build [options] [entry|pattern]

é€‰é¡¹ï¼š
    --mode          æŒ‡å®šç¯å¢ƒæ¨¡å¼ (é»˜è®¤å€¼ï¼šproduction)
    --dest          æŒ‡å®šè¾“å‡ºç›®å½• (é»˜è®¤å€¼ï¼šdist)
    --modern        é¢å‘ç°ä»£æµè§ˆå™¨å¸¦è‡ªåŠ¨å›é€€åœ°æ„å»ºåº”ç”¨
    --target        app | lib | wc | wc-async (é»˜è®¤å€¼ï¼šapp)
    --name          åº“æˆ– Web Components æ¨¡å¼ä¸‹çš„åå­— (é»˜è®¤å€¼ï¼špackage.json ä¸­çš„ "name" å­—æ®µæˆ–å…¥å£æ–‡ä»¶å)
    --no-clean      åœ¨æ„å»ºé¡¹ç›®ä¹‹å‰ä¸æ¸…é™¤ç›®æ ‡ç›®å½•çš„å†…å®¹
    --report        ç”Ÿæˆ report.html ä»¥å¸®åŠ©åˆ†æåŒ…å†…å®¹
    --report-json   ç”Ÿæˆ report.json ä»¥å¸®åŠ©åˆ†æåŒ…å†…å®¹
    --watch         ç›‘å¬æ–‡ä»¶å˜åŒ–
```

### æ‰“åŒ…é…ç½®

- é…ç½®æ–‡ä»¶`babel.config.js`

```javascript title="babel.config.js"
module.exports = {
	presets: [
		"@vue/cli-plugin-babel/preset",
		[
			"@babel/preset-env",
			{
				modules: false
			}
		]
	],
	compact: false,
	plugins: [
		[
			"component",
			// element-ui æŒ‰éœ€åŠ è½½
			{
				libraryName: "element-ui",
				styleLibraryName: "theme-chalk"
			}
		]
	],
	env: {
		development: {
			// ç»„ä»¶åŠ¨æ€å¯¼å…¥é…ç½® "@babel/plugin-syntax-dynamic-import"
			plugins: ["dynamic-import-node"]
		},
		production: {
			// ç”Ÿäº§ç¯å¢ƒç§»é™¤console
			plugins: ["transform-remove-console"]
		}
	}
};
```

:::tip babel é…ç½®æ–‡ä»¶ç›¸å…³æ’ä»¶

- `@vue/cli-plugin-babel`
- `@babel/preset-env`
- `@babel/plugin-syntax-dynamic-import`
- `transform-remove-console`
- `@babel/plugin-transform-runtime`

:::

- é…ç½®æ–‡ä»¶`vue.config.js`

```javascript title="vue.config.js"
module.exports = {
	// å¿½ç•¥ä¾èµ–åŒ… babel è½¬ç 
	transpileDependencies: true,
	publicPath: "/",
	outputDir: "dist",
	assetsDir: "static",
	// ä»£ç æ£€æŸ¥
	lintOnSave: isProd ? false : "warning",
	// æ‰“åŒ…ä»£ç ä¸ç”Ÿæˆ source map
	productionSourceMap: false,
	devServer: {
		host: "0.0.0.0",
		port: 8080,
		// æµè§ˆå™¨çƒ­æ›´æ–°
		hot: true,
		compress: true,
		proxy: {
			// ä»£ç†APIç½®
			[process.env.VUE_APP_API]: {
				target: "http://localhost:8080",
				changeOrigin: true,
				pathRewrite: {
					["^" + process.env.VUE_APP_API]: ""
				}
			}
		},
		client: {
			// æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯æç¤º
			overlay: false,
			// è¿›åº¦æ¡
			progress: true
		}
	},
	css: {
		loaderOptions: {
			sass: {
				// å…¨å±€å˜é‡ scss æ–‡ä»¶å¼•å…¥
				additionalData: `@import "~@/assets/css/variables.scss";`,
				sassOptions: { outputStyle: "expanded" }
			}
		}
	}
};
```

- gzip å‹ç¼©é…ç½®

```javascript title="vue.config.js"
// æ‰“åŒ…å‹ç¼©æ’ä»¶
const CompressionWebpackPlugin = require("compression-webpack-plugin");

module.exports = defineConfig({
	configureWebpack: {
		// externals: {
		// 	vue: "Vue",
		// 	vuex: "Vuex",
		// 	axios: "axios",
		// 	"vue-router": "VueRouter",
		// 	"element-ui": "ELEMENT"
		// } /* CDN */,
		cache: {
			type: "filesystem",
			allowCollectingMemory: isProd ? false : true
		},
		target: isProd ? "browserslist" : "web",
		name: name,
		performance: {
			hints: false
		},
		plugins: [
			new CompressionWebpackPlugin({
				algorithm: "gzip",
				filename: "[path][base].gz",
				test: /\.(js|css|json|html)(\?.*)?$/i,
				threshold: 10240,
				minRatio: 0.8
			})
		]
	}
});
```

- chainWebpack é…ç½®

```javascript title="vue.config.js"
const { defineConfig } = require("@vue/cli-service");
// æ‰“åŒ…ä¼˜åŒ–æ’ä»¶
const { ESBuildMinifyPlugin } = require("esbuild-loader");
// ä»£ç è·³è½¬ç¼–è¾‘å™¨æ’ä»¶
const { codeInspectorPlugin } = require("code-inspector-plugin");
// æ˜¯å¦ç”Ÿäº§ç¯å¢ƒ
const isProd = process.env.NODE_ENV === "production";
// ä»£ç è·³è½¬ç¼–è¾‘å™¨é…ç½®
const devCIP = codeInspectorPlugin({ bundler: "webpack", hideConsole: true, hideDomPathAttr: true });

module.exports = defineConfig({
	chainWebpack: config => {
		if (isProd) {
			// åˆ é™¤é¢„åŠ è½½æ–‡ä»¶
			config.plugins.delete("preload");
			config.plugins.delete("prefetch");
			// æ‰“åŒ…ä¼˜åŒ–
			const rule = config.module.rule("js");
			rule.uses.clear();
			rule.use("esbuild-loader").loader("esbuild-loader");
			config.optimization.minimizers.delete("terser");
			config.optimization.minimizer("esbuild").use(ESBuildMinifyPlugin, [{ minify: true, css: true }]);
		}
		if (process.env.NODE_ENV === "development") config.plugin("code-inspector-plugin").use(devCIP);
		// æ‰“åŒ…åˆ†ç‰‡
		config.when(process.env.NODE_ENV == "production", config => {
			config.optimization.splitChunks({
				chunks: "all",
				cacheGroups: {
					vendors: {
						name: "chunk-vendors",
						chunks: "initial",
						test: /[\\/]node_modules[\\/]/,
						priority: 1
					},
					elementUI: {
						name: "chunk-elementUI",
						priority: 2,
						test: /[\\/]node_modules[\\/]_?element-ui(.*)/,
						reuseExistingChunk: true
					},
					common: {
						name: "chunk-common",
						chunks: "all",
						test: /[\\/]src[\\/]/,
						minSize: 0,
						minChunks: 2,
						priority: 1,
						reuseExistingChunk: true
					},
					styles: {
						name: "styles",
						test: /\.(s?css|less|sass)$/,
						chunks: "all",
						enforce: true
					}
				}
			});
			config.optimization.runtimeChunk("single");
		});
	}
});
```

::: info webpack é…ç½®

- [webpack é…ç½®æ–‡æ¡£](https://webpack.docschina.org/configuration/)
- [webpack é…ç½®å‚è€ƒ](https://cli.vuejs.org/zh/guide/webpack.html)

:::

### å®Œæ•´é…ç½®

```javascript title="vue.config.js å®Œæ•´é…ç½®"
const { defineConfig } = require("@vue/cli-service");
// æ‰“åŒ…ä¼˜åŒ–æ’ä»¶
const { ESBuildMinifyPlugin } = require("esbuild-loader");
// ä»£ç è·³è½¬ç¼–è¾‘å™¨æ’ä»¶
const { codeInspectorPlugin } = require("code-inspector-plugin");
// æ‰“åŒ…å‹ç¼©æ’ä»¶
const CompressionWebpackPlugin = require("compression-webpack-plugin");
// ç½‘ç«™åç§°é…ç½®
const name = process.env.VUE_APP_TITLE;
// æ˜¯å¦ç”Ÿäº§ç¯å¢ƒ
const isProd = process.env.NODE_ENV === "production";
// ä»£ç è·³è½¬ç¼–è¾‘å™¨é…ç½®
const devCIP = codeInspectorPlugin({ bundler: "webpack", hideConsole: true, hideDomPathAttr: true });

module.exports = defineConfig({
	transpileDependencies: true,
	publicPath: "/",
	outputDir: "dist",
	assetsDir: "static",
	lintOnSave: isProd ? false : "warning",
	productionSourceMap: false,
	devServer: {
		host: "0.0.0.0",
		port: 8080,
		hot: true,
		compress: true,
		proxy: {
			[process.env.VUE_APP_API]: {
				target: "http://localhost:8080",
				changeOrigin: true,
				pathRewrite: {
					["^" + process.env.VUE_APP_API]: ""
				}
			}
		},
		client: {
			overlay: false,
			progress: true
		}
	},
	css: {
		loaderOptions: {
			sass: {
				additionalData: `@import "~@/assets/css/variables.scss";`,
				sassOptions: { outputStyle: "expanded" }
			}
		}
	},
	chainWebpack: config => {
		if (isProd) {
			// åˆ é™¤é¢„åŠ è½½æ–‡ä»¶
			config.plugins.delete("preload");
			config.plugins.delete("prefetch");
			// æ‰“åŒ…ä¼˜åŒ–
			const rule = config.module.rule("js");
			rule.uses.clear();
			rule.use("esbuild-loader").loader("esbuild-loader");
			config.optimization.minimizers.delete("terser");
			config.optimization.minimizer("esbuild").use(ESBuildMinifyPlugin, [{ minify: true, css: true }]);
		}
		if (process.env.NODE_ENV === "development") config.plugin("code-inspector-plugin").use(devCIP);
		// æ‰“åŒ…åˆ†ç‰‡
		config.when(process.env.NODE_ENV == "production", config => {
			config.optimization.splitChunks({
				chunks: "all",
				cacheGroups: {
					vendors: {
						name: "chunk-vendors",
						chunks: "initial",
						test: /[\\/]node_modules[\\/]/,
						priority: 1
					},
					elementUI: {
						name: "chunk-elementUI",
						priority: 2,
						test: /[\\/]node_modules[\\/]_?element-ui(.*)/,
						reuseExistingChunk: true
					},
					common: {
						name: "chunk-common",
						chunks: "all",
						test: /[\\/]src[\\/]/,
						minSize: 0,
						minChunks: 2,
						priority: 1,
						reuseExistingChunk: true
					},
					styles: {
						name: "styles",
						test: /\.(s?css|less|sass)$/,
						chunks: "all",
						enforce: true
					}
				}
			});
			config.optimization.runtimeChunk("single");
		});
	},
	configureWebpack: {
		// externals: {
		// 	vue: "Vue",
		// 	vuex: "Vuex",
		// 	axios: "axios",
		// 	"vue-router": "VueRouter",
		// 	"element-ui": "ELEMENT"
		// } /* CDN */,
		cache: {
			type: "filesystem",
			allowCollectingMemory: isProd ? false : true
		},
		target: isProd ? "browserslist" : "web",
		name: name,
		performance: {
			hints: false
		},
		plugins: [
			new CompressionWebpackPlugin({
				algorithm: "gzip",
				filename: "[path][base].gz",
				test: /\.(js|css|json|html)(\?.*)?$/i,
				threshold: 10240,
				minRatio: 0.8
			})
		]
	}
});
```

:::info æ‰“åŒ…é…ç½®æ€»ç»“

- æ‰“åŒ…è¾“å‡ºç›®å½•è®¾ç½®
- `publicPath`: è®¾ç½®é™æ€èµ„æºè·¯å¾„ï¼Œå¦‚ï¼š`/static`
- `outputDir`: è®¾ç½®æ‰“åŒ…è¾“å‡ºç›®å½•ï¼Œå¦‚ï¼š`dist`ã€`build`ã€`output`
- `assetsDir`: è®¾ç½®é™æ€èµ„æºç›®å½•ï¼Œå¦‚ï¼š`static`ã€`assets`ã€`public`
- `lintOnSave`: æ˜¯å¦å¼€å¯ eslint è¯­æ³•æ£€æŸ¥ï¼Œé»˜è®¤ä¸º `true`ï¼Œå¯ä»¥è®¾ç½®ä¸º `false` æˆ– `warning`
- `devServer`: å¼€å‘ç¯å¢ƒé…ç½®ï¼Œå¦‚ï¼š`host`ã€`port`ã€`hot`ã€`compress`ã€`proxy`ã€`client`
- `css`: è®¾ç½® css é…ç½®ï¼Œå¦‚ï¼š`loaderOptions`
- `chainWebpack`: é“¾å¼é…ç½®ï¼Œå¯ä»¥æ·»åŠ ã€åˆ é™¤ã€ä¿®æ”¹ webpack é…ç½®ï¼Œå¦‚ï¼š`externals`ã€`splitChunks`ã€`runtimeChunk`ã€`plugin` ç­‰

:::

### å‚è€ƒæ–‡æ¡£

[Vue CLI å®˜æ–¹æ–‡æ¡£](https://cli.vuejs.org/zh)ã€ŒğŸ‘ˆ ç‚¹å‡»æŸ¥é˜…ã€
