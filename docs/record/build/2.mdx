---
title: "Rsbuild é…ç½®"
author: "ä¸‹è½é¦™æ¨Ÿæ ‘"
---

# Rsbuild é…ç½®

### ä¾èµ–å®‰è£…

-   åˆ›å»º Rsbuild é¡¹ç›®

<Install value="create rsbuild@latest" />

-   å®‰è£… @rsbuild/core ä¾èµ–

<Install value="add @rsbuild/core -D" />

-   å®‰è£… @rsbuild/plugin-vue ä¾èµ–

<Install value="add @rsbuild/plugin-vue -D" />

-   å®‰è£… @rsbuild/plugin-vue2 ä¾èµ–

<Install value="add @rsbuild/plugin-vue2 -D" />

### æ‰“åŒ…é…ç½®

-   åˆ›å»º rsbuild.config.js æ–‡ä»¶
-   å‘½ä»¤è¡Œå·¥å…·é…ç½®

```shell title="å¯åŠ¨å‘½ä»¤é…ç½®"
{
    "scripts": {
        // å¯åŠ¨å¼€å‘æœåŠ¡å™¨
        "dev": "rsbuild dev",
        // æ„å»ºç”¨äºç”Ÿäº§çš„åº”ç”¨
        "build": "rsbuild build",
        // åœ¨æœ¬åœ°é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬
        "preview": "rsbuild preview"
    }
}
```

-   dev å¯åŠ¨é…ç½®

```bash title="å¯åŠ¨é…ç½®"
Usage: rsbuild dev [options]

Options:
    -c --config <config>  æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ä¸ºç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„
    -r --root <root>      æŒ‡å®šé¡¹ç›®æ ¹ç›®å½•ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹äº cwd çš„è·¯å¾„
    -m --mode <mode>      æŒ‡å®šæ„å»ºæ¨¡å¼ï¼Œå¯ä»¥æ˜¯ `development`ï¼Œ`production` æˆ– `none`
    -o, --open [url]      å¯åŠ¨æ—¶æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢
    --port <port>         è®¾ç½® Rsbuild Server ç›‘å¬çš„ç«¯å£å·
    --host <host>         æŒ‡å®š Rsbuild Server å¯åŠ¨æ—¶ç›‘å¬çš„ host
    --env-mode <mode>     æŒ‡å®š env æ¨¡å¼æ¥åŠ è½½ `.env.[mode]` æ–‡ä»¶
    --env-dir <dir>       æŒ‡å®šç›®å½•æ¥åŠ è½½ `.env` æ–‡ä»¶
    --environment <name>  æŒ‡å®šéœ€è¦æ„å»ºçš„ environment åç§°
    -h, --help            æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©
```

-   build æ„å»ºé…ç½®

```bash title="æ„å»ºé…ç½®"
Usage: rsbuild build [options]

Options:
    -c --config <config>  æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ä¸ºç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„
    -r --root <root>      æŒ‡å®šé¡¹ç›®æ ¹ç›®å½•ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹äº cwd çš„è·¯å¾„
    -m --mode <mode>      æŒ‡å®šæ„å»ºæ¨¡å¼ï¼Œå¯ä»¥æ˜¯ `development`ï¼Œ`production` æˆ– `none`
    -w --watch            å¼€å¯ watch æ¨¡å¼, ç›‘å¬æ–‡ä»¶å˜æ›´å¹¶é‡æ–°æ„å»º
    --env-mode <mode>     æŒ‡å®š env æ¨¡å¼æ¥åŠ è½½ `.env.[mode]` æ–‡ä»¶
    --env-dir <dir>       æŒ‡å®šç›®å½•æ¥åŠ è½½ `.env` æ–‡ä»¶
    --environment <name>  æŒ‡å®šéœ€è¦æ„å»ºçš„ environment åç§°
    -h, --help            æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©
```

-   preview é¢„è§ˆé…ç½®

```bash title="é¢„è§ˆé…ç½®"
Usage: rsbuild preview [options]

Options:
    -c --config <config>  æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼Œå¯ä»¥ä¸ºç›¸å¯¹è·¯å¾„æˆ–ç»å¯¹è·¯å¾„
    -r --root <root>      æŒ‡å®šé¡¹ç›®æ ¹ç›®å½•ï¼Œå¯ä»¥æ˜¯ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹äº cwd çš„è·¯å¾„
    -m --mode <mode>      æŒ‡å®šæ„å»ºæ¨¡å¼ï¼Œå¯ä»¥æ˜¯ `development`ï¼Œ`production` æˆ– `none`
    -o, --open [url]      å¯åŠ¨æ—¶æ˜¯å¦åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€é¡µé¢
    --port <port>         è®¾ç½® Rsbuild Server ç›‘å¬çš„ç«¯å£å·
    --host <host>         æŒ‡å®š Rsbuild Server å¯åŠ¨æ—¶ç›‘å¬çš„ host
    --env-mode <mode>     æŒ‡å®š env æ¨¡å¼æ¥åŠ è½½ `.env.[mode]` æ–‡ä»¶
    --env-dir <dir>       æŒ‡å®šç›®å½•æ¥åŠ è½½ `.env` æ–‡ä»¶
    --environment <name>  æŒ‡å®šéœ€è¦æ„å»ºçš„ environment åç§°
    -h, --help            æ˜¾ç¤ºå‘½ä»¤å¸®åŠ©
```

### å®Œæ•´é…ç½®

```javascript title="å®Œæ•´é…ç½®"
import { defineConfig, loadEnv } from "@rsbuild/core";
// vue2 æ’ä»¶
import { pluginVue2 } from "@rsbuild/plugin-vue2";
// sass æ’ä»¶
import { pluginSass } from "@rsbuild/plugin-sass";
// å›¾ç‰‡å‹ç¼©æ’ä»¶
import { pluginImageCompress } from "@rsbuild/plugin-image-compress";
// ä»£ç è·³è½¬ç¼–è¾‘å™¨æ’ä»¶
import { codeInspectorPlugin } from "code-inspector-plugin";
// gzip æ’ä»¶
import compressionPlugin from "compression-webpack-plugin";
// vue-cli è¿ç§» rsbuild é…ç½®ï¼šç¯å¢ƒå˜é‡é…ç½®
const { publicVars, parsed } = loadEnv({ prefixes: ["VUE_APP_"] });
// sass é…ç½®
const sassOPS = {
	sassLoaderOptions: {
		sourceMap: true,
		// å¿…é¡»é¡¹ï¼šå…¼å®¹å…¨å±€å¼•å…¥ scss
		implementation: require("sass"),
		// å¿…é¡»é¡¹ï¼šå¼•å…¥ scss å…¨å±€å˜é‡
		additionalData: `@import "@/assets/css/variables.scss";`
	}
};
// ä»£ç è·³è½¬ç¼–è¾‘å™¨é…ç½®
const codeOPS = {
	bundler: "rspack",
	hideConsole: true,
	hideDomPathAttr: true
};
// æ‰“åŒ…å‹ç¼©é…ç½®
const gzipOPS = {
	algorithm: "gzip",
	filename: "[path][base].gz",
	test: /\.(js|css)(\?.*)?$/g,
	threshold: 1024 * 30,
	minRatio: 0.8
};
// ç¯å¢ƒå˜é‡é…ç½®
const valueOPS = { ...publicVars, "process.env.VUE_APP_START": JSON.stringify("RSB") };

export default defineConfig(({ envMode, command }) => {
	const isDev = envMode === "development";
	const isBuild = command === "build";

	return {
		// æ‰“åŒ…æ¨¡å¼
		mode: isBuild ? "production" : "development",
		plugins: [pluginVue2(), pluginSass(sassOPS), pluginImageCompress()],
		tools: {
			rspack: {
				// gzip é…ç½®ã€ä»£ç è·³è½¬é…ç½®
				plugins: [isBuild ? new compressionPlugin(gzipOPS) : codeInspectorPlugin(codeOPS)],
				output: {
					// ç¦ç”¨å¼‚æ­¥åˆ†ç‰‡
					asyncChunks: false
				},
				// ç»ˆç«¯è¾“å‡ºé…ç½®
				stats: {
					warnings: false,
					colors: true
				},
				// æ‰“åŒ…åˆ†ç‰‡
				optimization: {
					runtimeChunk: "single"
				}
			}
		},
		source: {
			define: valueOPS,
			// å…¥å£æ–‡ä»¶
			entry: {
				index: "./src/main.js"
			},
			// è·¯å¾„åˆ«å
			alias: {
				"@": "./src"
			}
		},
		server: {
			open: true,
			port: isDev ? 8080 : 3000,
			compress: isBuild,
			historyApiFallback: true
		},
		dev: {
			// å¼€å‘ç¯å¢ƒè¿›åº¦æ¡
			progressBar: true,
			// ç¦ç”¨å‘½ä»¤è¡Œå¿«æ·é”®
			cliShortcuts: false
		},
		html: {
			// æ¨¡æ¿æ–‡ä»¶å…¥å£
			template: "./public/index.html",
			// favicon
			favicon: "./public/favicon.ico",
			// æ ‡é¢˜
			title: parsed.VUE_APP_TITLE
		},
		output: {
			// ä»£ç å…¼å®¹é…ç½®
			polyfill: "usage" /* 'entry' | 'usage' */,
			minify: isBuild,
			cleanDistPath: true,
			legalComments: "none",
			// å¯ç”¨ sourcemap
			sourceMap: {
				css: isBuild ? false : true,
				js: isBuild ? false : "eval" /* cheap-module-source-map */
			}
		},
		performance: {
			// ç§»é™¤ console
			removeConsole: true,
			// åˆ†å‰²ä»£ç 
			chunkSplit: isBuild
				? {
						strategy: "split-by-size",
						minSize: 1024 * 960,
						maxSize: 1024 * 1024 * 3
				  }
				: { strategy: "split-by-experience" }
		}
	};
});
```

:::info é…ç½®æ€»ç»“

-   æ­£å¸¸é…ç½®å‚è€ƒä¸‹æ–¹å®˜æ–¹æ–‡æ¡£å³å¯;
-   é…ç½®ä¸­ï¼Œ`define` é…ç½®å¯ä»¥é…ç½®ç¯å¢ƒå˜é‡ï¼Œä½†éœ€è¦é…åˆ `loadEnv` ä½¿ç”¨;
-   `source.entry` é…ç½®å¯ä»¥é…ç½®å…¥å£æ–‡ä»¶ï¼Œé»˜è®¤ä¸º `src/main.js`;
-   `source.alias` é…ç½®å¯ä»¥é…ç½®è·¯å¾„åˆ«åï¼Œé»˜è®¤ä¸º `@: src`ï¼›
-   `output.cleanDistPath` é…ç½®å¯ä»¥æ¸…é™¤æ„å»ºç›®å½•ï¼Œé»˜è®¤ä¸º `true`ï¼›
-   `output.legalComments` é…ç½®å¯ä»¥æ¸…é™¤æ„å»ºç›®å½•ï¼Œé»˜è®¤ä¸º `none`ï¼›
-   `output.sourceMap` é…ç½®å¯ä»¥é…ç½® sourcemapï¼Œé»˜è®¤ä¸º `eval`ï¼›
-   `output.polyfill` é…ç½®å¯ä»¥é…ç½® polyfillï¼Œé»˜è®¤ä¸º `usage`ï¼›
-   `dev.cliShortcuts` é…ç½®å¯ä»¥é…ç½®å‘½ä»¤è¡Œå¿«æ·é”®ï¼Œé»˜è®¤ä¸º `true`ï¼›
-   vue-cli è¿ç§» rsbuild é…ç½®ï¼š`define` é…ç½®å¯ä»¥é…ç½®ç¯å¢ƒå˜é‡ï¼Œä½†éœ€è¦é…åˆ `loadEnv` ä½¿ç”¨;
-   vue-cli è¿ç§» rsbuild é…ç½®ï¼š`source.alias` é…ç½®å¯ä»¥é…ç½®è·¯å¾„åˆ«åï¼Œé»˜è®¤ä¸º `@: src`;

:::

::: danger æ³¨æ„äº‹é¡¹

-   `scss` å…¨å±€å˜é‡é…ç½®éœ€åœ¨ `sassLoaderOptions.additionalData` ä¸­å¼•å…¥ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆ;
-   å¼•ç”¨`scss`æ—¶ï¼Œ`implementation: require("sass")`é…ç½®æ³¨æ„äº‹é¡¹;
-   `gzip` é…ç½®éœ€é…åˆ `compression-webpack-plugin` ä½¿ç”¨ï¼Œå¦åˆ™æ— æ³•ç”Ÿæ•ˆ;
-   å…¨å±€å˜é‡æ—¶ï¼Œéœ€è¦æ³¨æ„å˜é‡æ›¿æ¢

:::

### å‚è€ƒæ–‡æ¡£

[Rsbuild å®˜æ–¹æ–‡æ¡£](https://rsbuild.dev/zh/)ã€ŒğŸ‘ˆ ç‚¹å‡»æŸ¥é˜…ã€
