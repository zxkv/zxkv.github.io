---
author: ä¸‹è½é¦™æ¨Ÿæ ‘
description: JS ä¸ iOS å’Œ Android APP äº¤äº’
---

# JS ä¸ iOS å’Œ Android APP äº¤äº’

#### ä¸šåŠ¡éœ€æ±‚ï¼š

&emsp;&emsp;å‰æœŸåœ¨å¾®ä¿¡ H5 ç«¯ä¸ iOS å’Œ Android è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå€ŸåŠ©çš„æ˜¯å°è£…çš„**[WebViewJavascriptBridge](https://github.com/marcuswestin/WebViewJavascriptBridge)**å‡½æ•°ä¸ iOS è¿›è¡Œæ•°æ®äº¤äº’ï¼Œç„¶è€Œä¸ Android çš„æ•°æ®äº¤äº’è¿˜æ˜¯ä¸€ä¾æ®å°†äº¤äº’çš„äº‹ä»¶å‡½æ•°æŒ‚è½½åˆ° window ä¸Šï¼Œä»¥ä¾¿äº Android ç«¯ app è·å–äº‹ä»¶å‡½æ•°ã€‚è™½ç„¶è¿™ç§åšæ³•å¯ä»¥å®ç°æœ€ç»ˆçš„æ•ˆæœï¼Œå› ä¸º H5 æ´»åŠ¨é¡µé¢åœ¨ iOS ç«¯ appã€Android ç«¯ app ä»¥åŠå¾®ä¿¡ç«¯ H5 ä¸‰ç«¯ä½¿ç”¨ï¼Œä¸æ­¤åŒæ—¶è¿˜è¦ä¾æ®ä¸åŒå‚æ•°æˆ–è€…ä¸åŒ ua ä¿¡æ¯å¤„ç†ä¸åŒçš„äº‹ä»¶ï¼Œç›¸å¯¹æ¥è¯´ä»£ç é€»è¾‘æ¯”è¾ƒå¤æ‚ã€å†—ä½™ï¼Œå®¹æ˜“å‡ºé”™ï¼Œä¸ºæ­¤å°±å¯»æ‰¾ä¸€ä¸ªå¯ä»¥å¤šç«¯å…¬ç”¨çš„æ–¹æ³•ã€‚

&emsp;&emsp;æœ¬æ¬¡å°è£…çš„ JS ä¸ APP è¿›è¡Œæ•°æ®äº¤äº’çš„æ–¹æ³•è§£å†³äº†**iOSã€Androidã€WeChat**ä¸‰ç«¯å…±ç”¨çš„é—®é¢˜ï¼Œä»£ç é€»è¾‘ç»“æ„æ¸…æ™°æ˜äº†ã€ä¾¿äºåç»­é€»è¾‘çš„è°ƒæ•´å’Œä¼˜åŒ–ã€‚

#### è®¾å¤‡ä¿¡æ¯åˆ¤æ–­

```javascript title='è®¾å¤‡åˆ¤æ–­'
var u = navigator.userAgent;
// Android ç»ˆç«¯
var isAndroid = u.indexOf("Android") > -1 || u.indexOf("Adr") > -1;
// iOS ç»ˆç«¯
var isiOS = !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);
var isWeChat = u.match(/MicroMessenger/gi) == "micromessenger";
// æˆ–è€…
let ua = navigator.userAgent;
// Android ç«¯
let isAndroid = ua.indexOf("Android") > -1 || ua.indexOf("Linux") > -1;
// iOS ç»ˆç«¯
let isiOS = /iPhone|mac|iPod|iPad/i.test(ua);
//WeChat ç»ˆç«¯
let isWeChat = !!window.__wxjs_is_wkwebview;
```

:::tip ğŸ“± è®¾å¤‡æ£€æµ‹
é€šè¿‡ **navigator.userAgent** è·å–è®¾å¤‡ä¿¡æ¯ï¼Œåœ¨ä¾æ®ä¸åŒè®¾å¤‡çš„ä¸åŒå‚æ•°æ¥åŒºåˆ†å½“å‰è®¾å¤‡æ‰€å¤„çš„ç¯å¢ƒæ˜¯ Androidã€iOS è¿˜æ˜¯ WeChatã€‚
:::

#### è®¾å¤‡å…±ç”¨æ–¹æ³•

```javascript title='å°è£…äº¤äº’æ–¹æ³•'
function connectWebViewJavascriptBridge(callback) {
	if (isAndroid) {
		if (window.WebViewJavascriptBridge) {
			callback(WebViewJavascriptBridge);
		} else {
			document.addEventListener(
				"WebViewJavascriptBridgeReady",
				function () {
					callback(WebViewJavascriptBridge);
				},
				false
			);
		}
		return;
	}
	if (isiOS) {
		if (window.WebViewJavascriptBridge) {
			return callback(WebViewJavascriptBridge);
		}
		if (window.WVJBCallbacks) {
			return window.WVJBCallbacks.push(callback);
		}
		window.WVJBCallbacks = [callback];
		var WVJBIframe = document.createElement("iframe");
		WVJBIframe.style.display = "none";
		WVJBIframe.src = "https://__bridge_loaded__";
		document.documentElement.appendChild(WVJBIframe);
		setTimeout(function () {
			document.documentElement.removeChild(WVJBIframe);
		}, 0);
	}
}
// è°ƒç”¨æ³¨å†Œæ–¹æ³•
connectWebViewJavascriptBridge(function (bridge) {
	if (isAndroid) {
		bridge.init(function (message, responseCallback) {
			responseCallback(data);
		});
	}
});
```

#### è®¾å¤‡äº‹ä»¶äº¤äº’

```javascript title='äº¤äº’äº‹ä»¶'
// è°ƒç”¨Androidå’ŒiOSç«¯æ–¹æ³•ï¼Œå¹¶æ¥æ”¶è¿”å›æ•°æ®å›è°ƒjsæ–¹æ³•
window.WebViewJavascriptBridge.callHandler(
	"jsToAppFn",
	{
		orderInfo: data
	},
	function (res) {
		window.console.log(res);
	}
);

// æä¾›jsæ–¹æ³•ä¾›Androidå’ŒiOSç«¯è°ƒç”¨
window.WebViewJavascriptBridge.registerHandler("appToJsFn", function (data, responseCallback) {
	// data æ˜¯ APP ä¼ é€’è¿‡æ¥çš„æ•°æ®.
	// dataæ•°æ®ä¸¤ç«¯åå•†å¥½ï¼Œè‹¥ä½¿ç”¨JSONå­—ç¬¦ä¸²ï¼Œjsç«¯éœ€è¦è½¬æ¢JSONå¯¹è±¡
	// responseCallback æ˜¯ JS è°ƒç”¨å®Œæ¯•ä¹‹åä¼ é€’ç»™ APP çš„æ•°æ®
	responseCallback({
		key: "value"
	});
});
```
