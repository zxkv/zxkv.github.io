---
author: ä¸‹è½é¦™æ¨Ÿæ ‘
description: ä¹å®«æ ¼æŠ½å¥–æ¡ˆä¾‹
---

# ä¹å®«æ ¼æŠ½å¥–æ¡ˆä¾‹

### æŠ½å¥–æ¨¡å‹å’Œæ‹¼æ¥æ¨¡å‹

-   ä¹å®«æ ¼æ¨¡å‹ã€Œå›¾ 1ã€
    ![ä¹å®«æ ¼.png](./img/1-1.png)

-   æ‹¼æ¥å›¾æ¨¡å‹ã€Œå›¾ 2ã€
    ![æ‹¼æ¥å›¾.png](./img/1-2.png)

:::tip æç¤ºã€ŒğŸ“¢ã€ï¼š
&emsp;&emsp;å½“åŠ¨æ€å®ç°ä¹å®«æ ¼å¥–å“ä¿¡æ¯å±•ç¤ºæ—¶ï¼Œè‹¥æƒ³æŒ‰ç…§å›¾ 1 ä½ç½®æ˜¾ç¤ºå¥–å“ä¿¡æ¯ï¼Œåˆ™æ­¤æ—¶éœ€è¦æ¢ä¸€ä¸‹ä¹å®«æ ¼çš„ä½ç½®ã€‚
&emsp;&emsp;æ›¿æ¢ä½ç½®ä¸ºï¼š4â†’8ã€6â†’4ã€8â†’6ã€9â†’5ã€5â†’â—‹ï¼ˆâ—‹ å³æŠ½å¥–æŒ‰é’®ï¼‰
:::

### å°è£…å¥–å“åˆ—è¡¨æ’åºæ–¹æ³•

```javascript title="ä»£ç ç¤ºä¾‹"
/* ä¹å®«æ ¼å¥–å“åˆ—è¡¨æ’åº */
function sortList(data, el) {
	var ID4,
		str = "";
	for (var i = 0; i < data.length; i++) {
		if (i == 3) {
			//3->7
			str += "<div class='prize jp-" + 7 + "'><img src='" + data[i].pic + "'><p>" + data[i].name + "</p></div>";
		} else if (i == 4) {
			// 4
			ID4 = 4;
			str += "<div id='Btn'><p>å¼€å§‹æŠ½å¥–</p></div>";
		} else if (i == 5) {
			//5->3
			str += "<div class='prize jp-" + 3 + "'><img src='" + data[i].pic + "'><p>" + data[i].name + "</p></div>";
		} else if (i == 7) {
			//7->5ã€8->4
			str +=
				"<div class='prize jp-" +
				5 +
				"'><img src='" +
				data[i].pic +
				"'><p>" +
				data[i].name +
				"</p></div><div class='prize jp-" +
				ID4 +
				"'><img src='" +
				data[ID4].pic +
				"'><p>" +
				data[ID4].name +
				"</p></div>";
		} else {
			str += "<div class='prize jp-" + i + "'><img src='" + data[i].pic + "'><p>" + data[i].name + "</p></div>";
		}
	}
	$("#" + el).html(str);
}

//åˆå§‹åŒ–æŠ½å¥–æŒ‰é’®ç‚¹å‡»å±æ€§
var click = false;
```

### åˆå§‹å…¨å±€å˜é‡ï¼ˆè·å¥–å¥–å“ä¸‹æ ‡ï¼‰

```javascript title="ä»£ç ç¤ºä¾‹"
// å¥–å“åˆ—è¡¨
var prizeList,
	// ä¸­å¥–ä¸‹æ ‡ï¼ˆåœ¨å¥–å“åˆ—è¡¨ä¸­çš„ä¸‹æ ‡ï¼‰
	prizeObj = {
		pIndex: ""
	};
```

### å¥–å“åŠ¨ç”»åˆå§‹åŒ–

```javascript title="ä»£ç ç¤ºä¾‹"
var luck = {
	index: -1, //å½“å‰è½¬åŠ¨åˆ°å“ª,èµ·ç‚¹ä½ç½®
	count: 0, //å…±æœ‰å¤šå°‘ä¸ªä½ç½®
	timer: 0, //setTimeoutçš„ID,ç”¨clearTimeoutæ¸…é™¤
	speed: 20, //åˆå§‹åŒ–è½¬åŠ¨é€Ÿåº¦
	times: 0, //è½¬åŠ¨æ¬¡æ•°
	cycle: 25, //è½¬åŠ¨åŸºæœ¬æ¬¡æ•°:å³è½¬åŠ¨å¤šå°‘æ¬¡ä¹‹åè¿›å…¥æŠ½å¥–ç¯èŠ‚
	prize: -1, //ä¸­å¥–ä½ç½®
	init: function (id) {
		if ($("#" + id).find(".prize").length > 0) {
			$luck = $("#" + id);
			$units = $luck.find(".prize");
			this.obj = $luck;
			this.count = $units.length;
			$luck.find(".jp-" + this.index).addClass("active");
		}
	},
	roll: function () {
		var index = this.index;
		var count = this.count;
		var luck = this.obj;
		$(luck)
			.find(".jp-" + index)
			.removeClass("active");
		index += 1;
		if (index > count - 1) index = 0;
		$(luck)
			.find(".jp-" + index)
			.addClass("active");
		this.index = index;
		return false;
	},
	stop: function (index) {
		this.prize = index;
		return false;
	}
};
```

### æ—¶é—´ã€è½¬é€Ÿã€ä¸­å¥–ä¸‹æ ‡æ§åˆ¶

```javascript title="ä»£ç ç¤ºä¾‹"
/* æ—¶é—´ã€é€Ÿåº¦ã€ä¸­å¥–ç¼–å·æ§åˆ¶ */
function roll() {
	luck.times += 1;
	luck.roll();
	if (luck.times > luck.cycle + 10 && luck.prize == luck.index) {
		clearTimeout(luck.timer);
		luck.prize = -1;
		luck.times = 0;
		click = false;
	} else {
		if (luck.times < luck.cycle) {
			luck.speed -= 20;
		} else if (luck.times == luck.cycle) {
			// å¥–å“ä½ç½®ä¸‹æ ‡ å…¨å±€å˜é‡prizeObjå¯¹è±¡ä¸ºä¸­å¥–ä¿¡æ¯
			if (prizeObj.pIndex != "") luck.prize = prizeObj.pIndex;
		} else {
			if (luck.times > luck.cycle + 10 && ((luck.prize == 0 && luck.index == 7) || luck.prize == luck.index + 1)) {
				luck.speed += 110;
			} else {
				luck.speed += 20;
			}
		}
		if (luck.speed < 40) luck.speed = 40;
		luck.timer = setTimeout(roll, luck.speed);
	}
	return false;
}
```

### åŠ è½½æŠ½å¥–åŠ¨ç”»

```javascript title="ä»£ç ç¤ºä¾‹"
luck.init("prizeBox");
/* ç‚¹å‡»æŠ½å¥– */
$("#Btn").click(function () {
	if (click) {
		return false;
	} else {
		$.ajax({
			async: false,
			url: "url",
			type: "post",
			data: {},
			dataType: "json",
			success: function (res) {
				if (res.code) {
					/* å¯»æ‰¾å•†å“ä¸‹æ ‡ */
					// å¯»æ‰¾ä¸­å¥–å•†å“ä¸‹æ ‡ä»£ç ...

					/* åŠ¨ç”» */
					// åˆå§‹è½¬é€Ÿ
					luck.speed = 100;
					// è§¦å‘åŠ¨ç”»
					roll();
					// æ¿€æ´»ç‚¹å‡»äº‹ä»¶
					click = true;
					// å»¶æ—¶åŠ¨ç”»
					setTimeout(function () {
						$("#mask").fadeIn();
					}, 3600);
					return false;
				} else {
					alert(res.message);
				}
			}
		});
		return false;
	}
});
```

### ä¸­å¥–å¥–å“ä½ç½®çš„åˆ¤æ–­ã€Œå›æ˜¾åˆ°ä¹å®«æ ¼ä¸Šã€

```javascript title="ä»£ç ç¤ºä¾‹"
function findPirzeIndex(data, goodId) {
	for (let j = 0, len = data.length; j < len; j++) {
		if (data[j].goodId == goodId) {
			switch (j) {
				case 0:
					prizeObj.pIndex = 0;
					break;
				case 3: // 3->7
					prizeObj.pIndex = 7;
					break;
				case 4: //
					prizeObj.pIndex = 4;
					break;
				case 5: // 5->3
					prizeObj.pIndex = 3;
					break;
				case 7: // 7->5
					prizeObj.pIndex = 5;
					break;
				default:
					prizeObj.pIndex = j;
			}
		}
	}
}
```

:::info æ€»ç»“ï¼š
&emsp;&emsp;é€šè¿‡è¯¥æ–¹æ³•æ¥æŸ¥æ‰¾ä¸­å¥–å¥–å“çš„ä½ç½®ï¼›æŸ¥æ‰¾çš„å…ƒç´ çš„ä¸‹æ ‡ä¸ºè¯¥å…ƒç´ åœ¨å…¶æ•°ç»„å¯¹è±¡ä¸­çš„ä½ç½®ä¸‹æ ‡ï¼Œæ­¤æ—¶å¯¹æ¯”å›¾ 1 å’Œå›¾ 2 ä¸¤ä¸ªå›¾è¡¨çš„ä½ç½®ä¿¡æ¯ï¼Œå°±å¯ä»¥ç¡®å®šä¸­å¥–å¥–å“æ‰€åœ¨å›¾ 1 è¡¨ç›˜çš„å…·ä½“ä½ç½®ã€‚
:::
