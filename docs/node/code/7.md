# Aliplayer è§†é¢‘ç‚¹æ’­åŠ å¯†æ’­æ”¾

### å‰è¨€

&emsp;&emsp;**aliplayer** è§†é¢‘ç‚¹æ’­åˆ†ä¸º **Flash** å’Œ **HTML5** ä¸¤ä¸ªç‰ˆæœ¬ï¼Œç§»åŠ¨ç«¯ä¸æ”¯æŒ Flash æ’­æ”¾å™¨ã€‚

&emsp;&emsp;**Flash** æ’­æ”¾å™¨å…¼å®¹ **IE8+**ï¼Œ**HTML5**æ’­å‘å™¨æ”¯æŒæ¯”è¾ƒæ–°çš„æµè§ˆå™¨ï¼Œå¯¹æµè§ˆå™¨çš„ç‰ˆæœ¬è¦æ±‚è¾ƒ **Flash** æ’­æ”¾å™¨å¯¹æµè§ˆå™¨çš„ç‰ˆæœ¬çš„è¦æ±‚è¦é«˜ä¸€äº›ã€‚

å…¶ä¸­ï¼š

&emsp;&emsp;**h5**æ’­æ”¾å™¨åœ¨ç§»åŠ¨ç«¯ä¸æ”¯æŒ **flv** å’Œ **rtmp** çš„æ’­æ”¾ï¼›

&emsp;&emsp;æ’­æ”¾**flv**ã€**m3u8**è§†é¢‘ï¼Œ**PC**ç«¯æ”¯æŒçš„æµè§ˆå™¨ï¼Œéœ€è¦å¯ç”¨[å…è®¸è·¨åŸŸè®¿é—®](https://help.aliyun.com/document_detail/62950.html)

### HLS æ ‡å‡†åŠ å¯†ä¸ MPS ç§æœ‰åŠ å¯†å¯¹æ¯”

| åŠ å¯†ç±»å‹/è®¾å¤‡ç¯å¢ƒ | **iOS** | **Android**        | **PC**                                               |
| ----------------- | ------- | ------------------ | ---------------------------------------------------- |
| æ ‡å‡†åŠ å¯† **HLS**  | âˆš       | âˆš                  | Chromeã€Firefoxã€Safariã€Edgeã€IE 11+for Windows8.1+ |
| ç§æœ‰åŠ å¯† **MPS**  | Ã—       | Chrome for Android | Chromeã€Firefoxã€Safariã€Edgeã€IE 11+for Windows8.1+ |

#### Aliplayer æ’­æ”¾å™¨ Demo

:::warning åœ¨çº¿é…ç½®ã€ŒğŸ¾ã€
&emsp;&emsp;[Aliplayer åœ¨çº¿é…ç½®ç½‘å€(ç‚¹å‡»è®¿é—® ğŸ‘ˆ)](https://player.alicdn.com/aliplayer/index.html)
:::

#### HTML ä»£ç 

```html title="ä»£ç ç¤ºä¾‹"
<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title>ç”¨æˆ·æµ‹è¯•ç”¨ä¾‹</title>
		<!-- aliplayeræ ·å¼è¡¨ -->
		<link rel="stylesheet" href="https://g.alicdn.com/de/prismplayer/2.8.2/skins/default/aliplayer-min.css" />
		<!-- aliplayer Flashç‰ˆ&HTML5ç‰ˆ -->
		<script src="https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-min.js" type="text/javascript" charset="utf-8"></script>
		<!-- Flashç‰ˆ -->
		<script src="https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-flash-min.js" type="text/javascript" charset="utf-8"></script>
		<!-- HTML5ç‰ˆ -->
		<script src="https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-h5-min.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<div class="prism-player" id="J_prismPlayer"></div>
	</body>
</html>
```

#### JavaScript ä»£ç 

```javascript title="ä»£ç ç¤ºä¾‹"
var player = new Aliplayer(
	{
		id: "J_prismPlayer",
		width: "100%",
		autoplay: true,
		//æ”¯æŒæ’­æ”¾åœ°å€æ’­æ”¾,æ­¤æ’­æ”¾ä¼˜å…ˆçº§æœ€é«˜
		source: "æ’­æ”¾url",

		//æ’­æ”¾æ–¹å¼äºŒï¼šç‚¹æ’­ç”¨æˆ·æ¨è
		vid: "",
		playauth: "ddd",
		cover: "logo.png",

		//æ’­æ”¾æ–¹å¼ä¸‰ï¼šä»…MPSç”¨æˆ·ä½¿ç”¨ï¼ˆç§æœ‰åŠ å¯†æ’­æ”¾ï¼‰
		vid: "",
		accId: "dd",
		accSecret: "dd",
		stsToken: "dd",
		domainRegion: "dd",
		authInfo: "dd",

		//æ’­æ”¾æ–¹å¼å››ï¼šä½¿ç”¨STSæ–¹å¼æ’­æ”¾
		vid: "",
		accessKeyId: "dd",
		securityToken: "dd",
		accessKeySecret: "dd",
		region: "cn-shanghai"
	},
	function (player) {
		console.log("æ’­æ”¾å™¨åˆ›å»ºå¥½äº†ã€‚");
	}
);
```

:::tip é…ç½®æ–‡æ¡£ã€ŒğŸ“œã€
&emsp;&emsp;[Aliplayer å±æ€§å’Œæ¥å£ä½¿ç”¨è¯´æ˜](https://help.aliyun.com/document_detail/62941.html?spm=a2c4g.11186623.4.1.6a391c4cya8wTA)ã€ŒğŸ‘ˆ ç‚¹å‡»è®¿é—®ã€
:::

#### Vue ä¸­ä½¿ç”¨ Aliplayer æ’­å‘å™¨

:::warning æ³¨æ„ã€ŒğŸ‘€ã€
&emsp;&emsp;ç°åœ¨ **index.html** ä¸­å¼•å…¥ **aliplayer** çš„ **css** å’Œ **js**ï¼Œæˆ–è€…åœ¨å½“å‰ **vue** æ–‡ä»¶ä¸­å¼•å…¥ **aliplayer** çš„ **css** å’Œ**js**ã€‚
:::

```html title="ä»£ç ç¤ºä¾‹"
<template>
	...
	<!-- å¼•å…¥aliplayeræ’­æ”¾å™¨ -->
	<div class="prism-player" id="player-con"></div>
	...
</template>
```

#### åˆå§‹åŒ– **aliplayer** æ’­å‘å™¨

```javascript title="ä»£ç ç¤ºä¾‹"
export default {
	data() {
		return {
			player: {},
			timer: null
		};
	},
	created() {
		this.loading = this.$loading({
			background: "rgba(0, 0, 0, 0.5)",
			text: "æ‹¼å‘½åŠ è½½ä¸­"
		});
	},
	methods: {
		// é”€æ¯å’Œé‡å»ºaliplayer
		changePlayer(dt) {
			this.player.dispose();
			this.initPlayer(dt);
		},
		// è·å–è§†é¢‘æ’­æ”¾ä¿¡æ¯
		getKeyInfo(videoId, flag) {
			this.$axios
				.post(
					"XXXXXToken",
					qs.stringify({
						videoId
					})
				)
				.then(res => {
					let data = res.data;
					if (data.code == 1) {
						let dt = data.result_data;
						// æ˜¯å¦åˆæ¬¡åˆ›å»ºï¼Ÿåˆæ¬¡åˆ›å»ºæ’­æ”¾å™¨ï¼šé”€æ¯å’Œé‡å»ºæ’­å‘å™¨
						flag ? this.initPlayer(dt) : this.changePlayer(dt);
					}
				});
		},
		// åˆå§‹åŒ–è§†é¢‘æ’­æ”¾å™¨
		initPlayer(data) {
			// æ¸…ç©ºdomèŠ‚ç‚¹
			document.getElementById("player-con").innerHTML = "";
			// æ”¹å˜thisæŒ‡å‘ï¼Œä½¿å…¶æŒ‡å‘å½“å‰thisæŒ‡å‘ã€‚
			let _this = this,
				token = sessionStorage.getItem("token"),
				userId = sessionStorage.getItem("userId"),
				isConfirm = sessionStorage.getItem("isConfirm");
			this.player = new Aliplayer(
				{
					id: "player-con", // æ’­æ”¾å™¨id
					format: "m3u8", // è§†é¢‘æ ¼å¼
					width: "100%",
					height: "450px",
					playsinline: true,
					preload: true,
					encryptType: 1,
					// HLSæ ‡å‡†åŠ å¯†ä¸º0ï¼ˆé»˜è®¤ï¼‰,MPSç§æœ‰è§†é¢‘åŠ å¯†ä¸º1
					controlBarVisibility: "always",
					useH5Prism: true,
					// è§†é¢‘åº•éƒ¨çŠ¶æ€å·¥å…·æ è®¾ç½®ï¼Œé»˜è®¤ä¸ºfalseï¼Œå…¨æ˜¾ç¤º
					skinLayout: [
						{
							name: "bigPlayButton",
							align: "blabs",
							x: 30,
							y: 80
						},
						{
							name: "H5Loading",
							align: "cc"
						},
						{
							name: "errorDisplay",
							align: "tlabs",
							x: 0,
							y: 0
						},
						{
							name: "infoDisplay"
						},
						{
							name: "tooltip",
							align: "blabs",
							x: 0,
							y: 56
						},
						{
							name: "thumbnail"
						},
						{
							name: "controlBar",
							align: "blabs",
							x: 0,
							y: 0,
							children: [
								{
									name: "progress",
									align: "blabs",
									x: 0,
									y: 44
								},
								{
									name: "playButton",
									align: "tl",
									x: 15,
									y: 12
								},
								{
									name: "timeDisplay",
									align: "tl",
									x: 10,
									y: 7
								},
								{
									name: "fullScreenButton",
									align: "tr",
									x: 10,
									y: 12
								},
								{
									name: "volume",
									align: "tr",
									x: 5,
									y: 10
								}
							]
						}
					],
					// MPS
					vid: "vid",
					accId: "accId",
					accSecret: "accSecret",
					stsToken: "stsToken",
					domainRegion: "cn-beijing",
					authInfo: '{"ExpireTime": "' + expireTime + '","MediaId": "' + videoId + '","Signature": "' + signature + '"}'
				},
				function (player) {
					// html5ç‰ˆæœ¬çš„è§†é¢‘äº‹ä»¶å†™åœ¨å½“å‰callbackä¸­
					player.play();

					// å®šæ—¶å™¨
					let clear = () => {
						if (_this.timer) {
							clearTimeout(_this.timer);
							_this.timer = null;
						}
					};

					// è·å–æ’­æ”¾æ—¶é—´
					let getTimes = () => {
						if (player.getCurrentTime() >= 60) {
							if (isConfirm == 0) {
								player.pause();
								player.fullscreenService.cancelFullScreen();
							}
						}
						// é€’å½’å›è°ƒï¼Œè®¡ç®—æ’­æ”¾æ—¶é—´
						_this.timer = setTimeout(getTimes, 1000);
					};

					player.on("ready", function (e) {
						// é¦–æ¬¡æ’­æ”¾
						clear();
						getTimes();
						player.on("play", function (e) {
							// æ’­æ”¾è§†é¢‘
							clear();
							getTimes();
						});
						player.on("pause", function (e) {
							// æš‚åœè§†é¢‘æ’­æ”¾
							clear();
						});
						player.on("ended", function (e) {
							// è§†é¢‘æ’­æ”¾ç»“æŸ
							clear();
						});
						player.on("error", function (e) {
							// è§†é¢‘æ’­æ”¾å¤±è´¥
							clear();
						});
					});
				}
			);
		},
		// åˆ‡æ¢è§†é¢‘æ’­æ”¾æºï¼šä½¿ç”¨å‡½æ•°æˆªæµï¼Œé˜²æ­¢å¤šæ¬¡è§¦å‘å½±å“æ•°æ®å±•ç¤º
		switchVideo: Debounce(function (index, videoId, isPerchase) {
			this.mark = index;
			this.getKeyInfo(videoId);
			this.isPerchase = isPerchase == undefined ? true : isPerchase;
		}, 500)
	},
	// ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼šé”€æ¯
	destroyed() {
		// æ¸…é™¤å®šæ—¶å™¨
		clearInterval(this.timer);
		this.timer = null;
		let play = this.player,
			len = Object.keys(play);
		if (!len) return;
		// é”€æ¯æ’­æ”¾å™¨
		play.dispose();
	}
};
```

:::tip æ³¨æ„ã€ŒğŸ‘€ã€
&emsp;&emsp;æ’­æ”¾å™¨ä¸­éšè—äº†ç”»ä¸­ç”»ã€ç”»è´¨åˆ‡æ¢ã€è§†é¢‘ä¸‹è½½ç­‰åŠŸèƒ½ã€‚
:::
