# ä¸Šæ‹‰åŠ è½½&ä¸‹æ‹‰åˆ·æ–°

### â¬ æ’ä»¶ä¸‹è½½

-   jQuery-mescroll æ’ä»¶ï¼š[jq-mescroll.7z](https://www.yuque.com/attachments/yuque/0/2019/7z/271255/1554855907062-dce00b6f-2ff2-46b2-bdbe-497889ce5c26.7z?_lake_card=%7B%22uid%22%3A%22rc-upload-1554855352282-8%22%2C%22src%22%3A%22https%3A%2F%2Fwww.yuque.com%2Fattachments%2Fyuque%2F0%2F2019%2F7z%2F271255%2F1554855907062-dce00b6f-2ff2-46b2-bdbe-497889ce5c26.7z%22%2C%22name%22%3A%22jq-mescroll.7z%22%2C%22size%22%3A646081%2C%22type%22%3A%22%22%2C%22ext%22%3A%227z%22%2C%22progress%22%3A%7B%22percent%22%3A0%7D%2C%22status%22%3A%22done%22%2C%22percent%22%3A0%2C%22id%22%3A%22VhHvY%22%2C%22card%22%3A%22file%22%7D)

### ğŸš² HTML é¡µé¢ç¤ºä¾‹

```html title="ä»£ç ç¤ºä¾‹"
<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<title>title-list</title>
		<!-- é‡ç½®æ ·å¼ -->
		<link rel="stylesheet" type="text/css" href="css/reset.min.css" />
		<!-- æ’ä»¶å°è£…æ ·å¼ -->
		<link rel="stylesheet" type="text/css" href="css/mescroll.min.css" />
		<!-- å½“å‰é¡µé¢cssæ ·å¼ -->
		<link rel="stylesheet" type="text/css" href="css/list.css" />
	</head>
	<body>
		<div class="header">
			<!-- åˆ—è¡¨æ ‡é¢˜ -->
			<p style="line-height:24px;">åˆ—è¡¨æ ‡é¢˜åç§°</p>
			<!-- åˆ—è¡¨è¡¨å¤´ -->
			<div class="nav">
				<p class="active" i="0">åˆ†ç±»0</p>
				<p i="1">åˆ†ç±»1</p>
				<p i="2">åˆ†ç±»2</p>
			</div>
		</div>
		<!-- å†…å®¹æ»‘åŠ¨åŒº -->
		<div id="mescroll" class="mescroll">
			<ul id="dataList" class="data-list"></ul>
		</div>
	</body>
	<script src="js/zepto.min.js"></script>
	<!-- æ’ä»¶å°è£…js -->
	<script src="js/mescroll.min.js"></script>
	<!-- å½“å‰é¡µé¢js -->
	<script src="js/list.js"></script>
</html>
```

### ğŸ CSS æ ·å¼ç¤ºä¾‹

```css title="ä»£ç ç¤ºä¾‹"
* {
	margin: 0;
	padding: 0;
	-webkit-touch-callout: none;
	-webkit-user-select: none;
	-webkit-tap-highlight-color: transparent;
}
body {
	background-color: #fff;
}
ul {
	list-style-type: none;
}
a {
	text-decoration: none;
	color: #18b4fe;
}
.header {
	z-index: 999;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	line-height: 16px;
	padding-top: 12px;
	text-align: center;
	background-color: #fff;
}
.header .nav {
	margin-top: 12px;
	border-bottom: 1px solid #ddd;
}
.header .nav p {
	display: inline-block;
	width: 30%;
	padding: 5px 0;
}
.header .nav .active {
	color: #ffa54c;
	border-bottom: 1px solid #ffa54c;
}
.mescroll {
	position: fixed;
	top: 84px;
	bottom: 0;
	height: auto;
}
.data-list li {
	position: relative;
	padding: 10px 8px 10px 120px;
	border-bottom: 1px solid #eee;
}
.data-list .pd-img {
	width: 80px;
	height: 80px;
	position: absolute;
	top: 50%;
	left: 18px;
	-webkit-transform: translateY(-50%);
	transform: translateY(-50%);
}
.data-list .pd-name {
	font-size: 16px;
	height: 32px;
	overflow: hidden;
	text-overflow: ellipsis;
	white-space: nowrap;
}
.data-list .pd-price {
	color: #333;
	line-height: 18px;
	font-size: 14px;
}
.data-list .pd-sold {
	font-size: 12px;
	margin-top: 8px;
	color: gray;
}
```

### ğŸš— JavaScript é€»è¾‘ç¤ºä¾‹

```javascript title="ä»£ç ç¤ºä¾‹"
$(function () {
	// è·å–åœ°å€æ å‚æ•°
	function getQueryString(name) {
		var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"),
			r = window.location.search.substr(1).match(reg);
		return r ? decodeURI(r[2]) : null;
	}

	// åˆå§‹åŒ–mescroll
	var mescroll = new MeScroll("mescroll", {
		up: {
			callback: getListData,
			noMoreSize: 4,
			// æ²¡æœ‰æ•°æ®æ—¶å€™çš„æç¤º
			empty: {
				icon: "../res/img/mescroll-empty.png",
				btntext: "æš‚æ— æ•°æ®",
				btnClick: function () {}
			},
			clearEmptyId: "dataList"
		}
	});

	/*åˆå§‹åŒ–èœå•*/
	var pdType = 0;
	$(".nav p").click(function () {
		var i = $(this).attr("i");
		if (pdType != i) {
			pdType = i;
			$(".nav .active").removeClass("active");
			$(this).addClass("active");
			mescroll.resetUpScroll();
		}
	});

	/* é“¾æ¥è·³è½¬ */
	$("#dataList").on("click", "li", function (e) {
		// é€šè¿‡äº‹ä»¶å§”æ‰˜å®ç°è·å–æ¯ä¸€ä¸ªåˆ—è¡¨çš„æ•°æ®ï¼Œå¹¶å®ç°è·³è½¬
		window.location.href = "index.html";
	});

	function getListData(page) {
		getListDataFromNet(
			pdType,
			page.num,
			page.size,
			function (data) {
				// å¯¹è¯·æ±‚çš„æ•°æ®è¿›è¡Œåˆ¤æ–­å¤„ç†
				mescroll.endSuccess(data.length);
				setListData(data);
			},
			function () {
				mescroll.endErr();
			}
		);
	}

	// DOMæ‹¼æ¥æ¸²æŸ“
	function setListData(data) {
		var $dataList = $("#dataList");
		// åˆ—è¡¨é¡¹å­—ç¬¦ä¸²æ‹¼æ¥
		for (var i = 0, str = ""; i < data.length; i++) {
			let pd = data[i];
			str +=
				'<li data-id="' +
				pd.id +
				'" data-url="' +
				pd.videoUrl +
				'"><img class="pd-img" src="' +
				pd.imgUrl +
				'"/><p class="pd-name">' +
				pd.videoName +
				'</p><p class="pd-price">' +
				pd.desc +
				'</p><p class="pd-sold">æµè§ˆé‡ï¼š' +
				pd.number +
				"</p></li>";
		}
		$dataList.append(str);
	}

	function getListDataFromNet(pdType, pageNum, pageSize, successCallback, errorCallback) {
		const api = "api_url";
		// å®šæ—¶å™¨çš„ä½œç”¨æ˜¯æ¨¡æ‹Ÿç½‘ç»œå»¶è¿Ÿ
		setTimeout(function () {
			$.ajax({
				type: "POST",
				url: api,
				data: {
					pageIndex: pageNum, // pageNumé»˜è®¤å€¼ä¸º1
					type: pdType // typeç±»å‹
				},
				success: function (res) {
					if (res.code) {
						let data = res.data;
						// è¯·æ±‚æˆåŠŸå›è°ƒ
						successCallback(data);
					} else {
						// è¯·æ±‚å¤±è´¥æç¤º
						mescroll.endErr();
					}
				},
				error: function (err) {
					// è¯·æ±‚å¤±è´¥å›è°ƒ
					mescroll.endErr();
				}
			});
		}, 500);
	}
});
```
